@model Red_Folder.com.Models.Activity.Weekly

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Weekly Activity - Week @Model.WeekNumber of @Model.Year</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <style>
        body {
            display: grid;
            /*grid-template-rows: 100px auto auto;*/
            grid-template-columns: 10% 40% 10% 40%;
            grid-template-areas: "header-logo header-section header-section header-section" "podcasts-summary-logo podcasts-summary-section skills-summary-logo skills-summary-section" "pluralsight-logo pluralsight-section pluralsight-section pluralsight-section " "what-is-this-logo what-is-this-section what-is-this-section what-is-this-section";
        }

        #header-logo {
            grid-area: header-logo;
        }

            #header-logo img {
                max-width: 100%;
                max-height: 100%;
            }

            #header-logo .header-icon {
                padding-top: 0px;
            }

        #header-section {
            grid-area: header-section;
        }

        #what-is-this-logo {
            grid-area: what-is-this-logo;
        }

        #what-is-this-section {
            grid-area: what-is-this-section;
        }

        #podcasts-summary-logo {
            grid-area: podcasts-summary-logo;
        }

        #podcasts-summary-section {
            grid-area: podcasts-summary-section;
            margin-right: 15px;
        }

        #skills-summary-logo {
            grid-area: skills-summary-logo;
        }

        #skills-summary-section {
            grid-area: skills-summary-section;
        }

        #pluralsight-logo {
            grid-area: pluralsight-logo;
        }

        #pluralsight-section {
            grid-area: pluralsight-section;
        }

        #podcasts-detail-logo {
            grid-area: podcasts-detail-logo;
            display: none;
        }

        #podcasts-detail-section {
            grid-area: podcasts-detail-section;
            display: none;
        }

        i {
            font-size: 75px;
            color: white;
        }

        .header {
            background-color: #e74c3c;
        }

        .header-icon {
            background-color: #e74c3c;
            padding-top: 15px;
            padding-bottom: 15px;
            text-align: center;
            margin-bottom: 15px;
        }

        h1 {
            font-size: 45px;
            padding-top: 24px;
            font-family: Tahoma, Verdana, sans-serif;
            padding-bottom: 5px;
        }

        h1, h2 {
            background-color: #e74c3c;
            color: white;
            margin-top: 0px;
            margin-bottom: 0px;
            padding-left: 15px;
        }

        p {
            margin-top: 5px;
            padding-left: 15px;
        }

        #podcastChart {
            margin-top: 15px;
            margin-bottom: 15px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js" /></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>
</head>

<body>
    <div id="header-logo">
        <div class="header-icon">
            <img src="~/images/RFCLogo128.png" />
        </div>
    </div>
    <div id="header-section">
        <h1>The weekly retro</h1>
        <p>Week @Model.WeekNumber - from @Model.Start.ToShortDateString() to @Model.End.ToShortDateString()</p>
    </div>
    <div id="what-is-this-logo">
        <div class="header-icon">
            <i class="far fa-question-circle"></i>
        </div>
    </div>
    <div id="what-is-this-section">
        <h2>What is this?</h2>
        <p>
            The weekly retro is my attempt to show what I've been doing in the past week.  Bascially think shameless self-promotion.  Over the coming weeks (maybe months) I'm going to add more to this overview.
        </p>
    </div>

    <div id="podcasts-summary-logo">
        <div class="header-icon">
            <i class="fas fa-podcast"></i>
        </div>
    </div>
    <div id="podcasts-summary-section">
        <h2>
            Listened to <time-period seconds="@Model.PodCasts.TotalDuration"></time-period> of Podcasts
        </h2>

        <canvas id="podcastChart" width="500px" height="400px"></canvas>
    </div>
    <div id="podcasts-detail-logo">Podcast Logo</div>
    <div id="podcasts-detail-section">
        <h2>
            Podcast Details
        </h2>


        <ul>
            @foreach (var category in Model.PodCasts.Categories)
            {
                <li>
                    @category.Name (<time-period seconds="@category.TotalDuration"></time-period>)
                    <ul>
                        @foreach (var podcast in category.PodCasts)
                        {
                            <li>
                                @podcast.FeedName - @podcast.EpisodeName (<time-period seconds="podcast.EpisodeDuration"></time-period>)
                            </li>
                        }
                    </ul>
                </li>
            }
        </ul>
    </div>

    <div id="skills-summary-logo">
        <div class="header-icon">
            <i class="fas fa-drafting-compass"></i>
        </div>
    </div>
    <div id="skills-summary-section">
        <h2>
            Skills used
        </h2>
        <div id="skills-cloud">
        </div>
    </div>

    <div id="pluralsight-logo">
        <div class="header-icon">
            <i class="far fa-question-circle"></i>
        </div>
    </div>
    <div id="pluralsight-section">
        <h2>Puralsight</h2>
        @foreach (var course in Model.Pluralsight.Courses)
        {
        <div>
            <img src="pluralsight-chart" alt="Alternate Text" width="100px" height="100px" />
            <p>@course.Name</p>
            <canvas id="@course.Name-chart" width="100px" height="100px"></canvas>

            <script>
                window.onload = function () {
                    new Chart(document.getElementById('pluralsight-chart'), {
                        type: 'donut',
                        data: {
                            datasets: [{
                                data: [
                                    @course.PercentageComplete,
                                    100 - @course.PercentageComplete
                                ]
                            }]
                        }
                    });
                };
            </script>
        </div>
        }
    </div>

    <script>
        var config = {
            type: 'radar',
            data: {
                labels: [
                    @foreach (var category in Model.PodCasts.Categories.OrderBy(category => category.Name))
                    {
                        @:'@Html.Raw(category.Name)',
                    }
                ],
                datasets: [{
                    label: 'Podcast breakdown',
                    backgroundColor: 'rgba(231, 76, 60, 0.3)',
                    borderColor: 'rgba(231, 76, 60, 1)',
                    pointBackgroundColor: 'rgba(231, 76, 60, 1)',
                    data: [
                        @foreach (var category in Model.PodCasts.Categories.OrderBy(category => category.Name))
                        {
                            @:'@((double)category.TotalDuration / 60 / 60)',
                        }
                    ]
                }]
            },
            options: {
                legend: {
                    display: false
                },
                title: {
                    display: false
                },
                scale: {
                    ticks: {
                        beginAtZero: true
                    },
                    pointLabels: {
                        fontSize: 20
                    }
                },
                responsive: false
            }
        };

        window.onload = function () {
            window.myRadar = new Chart(document.getElementById('podcastChart'), config);
        };
    </script>

    <script>
        var fill = d3.scale.category20();

        var layout = d3.layout.cloud()
            .size([500, 400])
            .words([
                @{
                    var maxDuration = Model.Skills.Skills.Max(x => x.TotalDuration);
                    var sizeIncrement = ((float)90) / maxDuration;
                    foreach(var skill in Model.Skills.Skills)
                    {
                    @:{ text: '@skill.Name', size: @(10 + (sizeIncrement * skill.TotalDuration)) },
                    }
                }
            ])
            .padding(5)
            .rotate(function () { return 0; })
            .font("Impact")
            .fontSize(function (d) { return d.size; })
            .on("end", draw);

                    layout.start();

        function draw(words) {
                        d3.select("#skills-cloud").append("svg")
                            .attr("width", layout.size()[0])
                            .attr("height", layout.size()[1])
                            .append("g")
                            .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                            .selectAll("text")
                            .data(words)
                            .enter().append("text")
                            .style("font-size", function (d) { return d.size + "px"; })
                .style("font-family", "Impact")
                .style("fill", function (d, i) { return fill(i); })
                .attr("text-anchor", "middle")
                .attr("transform", function (d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        })
                .text(function (d) { return d.text; });
                    }
    </script>
</body>

</html>